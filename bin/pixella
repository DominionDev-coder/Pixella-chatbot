#!/bin/bash
# Pixella - CLI Wrapper
# This script activates the virtual environment and runs the Pixella entrypoint.

# Get the script's directory (i.e., the bin directory)
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
# Project root is one level up from the script directory
PROJECT_ROOT="$( cd "$SCRIPT_DIR/.." && pwd )"

# Define virtual environment path relative to project root
VENV_DIR="$PROJECT_ROOT/.venv"

# Determine OS and activation command for venv
case "$(uname -s)" in
    Linux*|Darwin*) 
        VENV_ACTIVATE_CMD="source \"$VENV_DIR/bin/activate\""
        VENV_PYTHON_BIN="\"$VENV_DIR/bin/python\""
        ;;
    CYGWIN*|MINGW32*|MSYS*|windows*) 
        VENV_ACTIVATE_CMD="source \"$VENV_DIR/Scripts/activate\""
        VENV_PYTHON_BIN="\"$VENV_DIR/Scripts/python.exe\""
        ;;
    *) 
        echo "Error: Unsupported OS for Pixella wrapper."
        exit 1
        ;;
esac

# Activate the virtual environment
eval "$VENV_ACTIVATE_CMD"

# Execute the main entrypoint with all arguments
exec $VENV_PYTHON_BIN "$PROJECT_ROOT/entrypoint.py" "$@"